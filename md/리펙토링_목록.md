# 리펙토링 및 모듈화 대상 목록

본 문서는 `guitar_theory_app` 프로젝트의 유지보수성과 확장성을 높이기 위해 식별된 리펙토링 대상과 모듈화 제안을 정리합니다.

## 1. 공통 위젯 통합 (UI Modularization)

### 🚨 중복 코드 병합 (High Priority)
*   **`ChordInfoSection` 통합**: 
    *   **현상**: `lib/widgets/common/chord_info_section.dart`와 `lib/views/generator/widgets/chord_info_section.dart`에 동일한 클래스명의 위젯이 중복 존재함.
    *   **제안**: `generator` 내부의 파일을 삭제하고 `widgets/common`의 버전을 사용하도록 참조 수정. 필요 시 두 위젯의 기능을 병합하여 하나의 범용 위젯으로 개선.

### ♻️ 뷰 종속 위젯의 공용화 (Extraction)
*   **`CircleOfFifthsWheel` (Interactive) 분리**:
    *   **현상**: `lib/views/explorer/explorer_view.dart` 파일 내부에 `_WheelSection`이라는 Private 위젯으로 휠 터치 이벤트와 렌더링 로직(약 100라인)이 포함됨.
    *   **제안**: 터치 로직(`_handleWheelTap`)을 포함한 인터랙티브 휠 위젯을 `lib/widgets/common/wheel/interactive_circle_of_fifths.dart`로 분리하여 `Studio` 등 다른 탭에서도 재사용 가능하도록 변경.
*   **`ExplorerView` 내부 패널 분리**:
    *   **현상**: `ExplorerView`의 `LayoutBuilder` 내부에 `ModeSelector`, `InfoPanel`, `CagedList`, `DiatonicList`가 배치되어 있으나, 일부는 파일로 분리되어 있고 일부는 구조가 혼재됨.
    *   **제안**: `DiatonicList`, `CagedList`가 `lib/views/explorer/` 폴더 내부에 있다면, 향후 Studio 탭에서의 활용을 위해 `lib/widgets/theory/` 또는 `lib/widgets/common/`으로 이동 검토.

## 2. 비즈니스 로직 분리 (Logic Extraction)

### 🎼 화성학 로직의 이동 (View -> Utils/Provider)
*   **스케일 노트 분류 로직 (`ExplorerView`)**:
    *   **현상**: `ExplorerView.build` 메서드 내부에서 `TheoryUtils.calculateScaleNotes` 호출 후, `for` 루프를 돌며 코드톤(1,3,5,7)과 그 외 노트(Ghost)를 분류하는 로직이 직접 구현되어 있음.
    *   **제안**: 해당 로직을 `MusicState`의 Getter(`List<String> get currentScaleChordTones`)로 이동하거나 `TheoryUtils.classifyScaleNotes(scaleNotes, mode)` 함수로 추출. 뷰는 UI 렌더링에만 집중.
*   **휠 터치 좌표 계산 로직**:
    *   **현상**: `_WheelSection` 내부에 `atan2`, 거리 계산 등 삼각함수 로직이 포함됨.
    *   **제안**: 좌표를 입력받아 선택된 Key Index를 반환하는 순수 함수를 `GuitarUtils` 또는 별도 Helper 클래스로 분리하여 테스트 용이성 확보.

## 3. 상태 관리 구조 개선 (State Management)

### 🔄 Provider 역할 명확화
*   **`MusicState`와 `GeneratorState`**:
    *   **현상**: 두 Provider 모두 프렛보드 제어(`visibleIntervals`, `selectedCagedForm` 등) 상태를 관리함. 현재 `ViewControlStateMixin`으로 잘 공통화되어 있으나, 사용처에서 중복된 로직이 없는지 점검 필요.
    *   **제안**: `ExplorerView`에서 `MusicState`를 통해 프렛보드 데이터를 생성하는 부분과 `GeneratorView`의 방식이 일관성을 갖도록 맞춤 (예: 둘 다 ViewModel 패턴 또는 Provider 내부에서 `FretboardMap` 객체를 생성하여 반환).

## 4. 오디오 로직 점검 (Audio)

*   **오디오 트리거 일관성**:
    *   **현상**: 오디오 재생이 각 위젯(`DiatonicList` 등)의 `onTap`에서 개별적으로 호출되는지 확인 필요.
    *   **제안**: `AudioService` 또는 `MusicState` 내부에 `playChord(Chord chord)`와 같은 래퍼 메서드를 두고, 모든 뷰가 이를 경유하도록 하여 볼륨 제어, 로그, 예외 처리를 중앙 집중화.

## 5. 리펙토링 작업 순서 제안

1.  **중복 제거**: `ChordInfoSection` 파일 통합 및 임포트 정리.
2.  **로직 추출**: `ExplorerView`의 `build` 메서드 내 화성학 계산 로직을 `TheoryUtils`로 이동.
3.  **위젯 분리**: `_WheelSection`을 별도 파일로 분리.
4.  **구조 재배치**: `explorer` 폴더에 있는 재사용 가능한 위젯들을 `widgets/common` 하위로 이동.
