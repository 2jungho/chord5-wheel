# 악기 선택 및 프렛보드/코드 다이어그램 변경 작업 절차

## 개요
사용자가 환경설정에서 악기(기타, 베이스, 피아노)를 선택하면, 앱 전체의 프렛보드와 코드 다이어그램이 해당 악기에 맞춰 동적으로 변경되도록 기능을 구현합니다.

## 1. 사전 준비 (완료됨)
- [x] `lib/models/instrument_model.dart` 생성: 악기 타입 및 튜닝 정보 정의 모델
- [x] `lib/widgets/common/piano/piano_keys_widget.dart` 생성: 피아노 건반 시각화 위젯

## 2. 상태 관리 (State Management) 구현
### 목표: 선택된 악기 정보를 앱 전체에서 접근 가능하게 함
- [ ] `lib/providers/settings_state.dart` 수정
  - `_selectedInstrumentId` 변수 추가 (기본값: 'guitar_std')
  - `Instrument` 객체를 반환하는 getter `selectedInstrument` 추가
  - 악기 변경 함수 `setInstrument(String id)` 추가 및 `SharedPreferences` 저장 로직 구현
  - `Instrument` 모델의 프리셋 리스트(`allInstruments`)를 활용하여 선택 로직 구성

## 3. UI 구현: 환경설정 다이어로그
### 목표: 사용자가 악기를 변경할 수 있는 UI 제공
- [ ] `lib/widgets/common/dialogs/settings_dialog.dart` 수정
  - "악기 설정" 섹션 추가 (마스터 볼륨 아래 또는 적절한 위치)
  - DropdownButton 또는 ChoiceChip을 사용하여 지원 악기 목록 표시
    - 기타 (Standard)
    - 베이스 (4-String)
    - 피아노
  - 변경 시 `SettingsState.setInstrument` 호출

## 4. 위젯 리팩토링: 프렛보드 (Fretboard)
### 목표: 악기의 현(String) 개수와 튜닝에 맞춰 프렛보드 렌더링
- [ ] `lib/widgets/common/fretboard/fretboard_map_widget.dart` 수정
  - `SettingsState`를 `watch` 하여 현재 악기 정보 획득
  - **피아노 선택 시**: `FretboardMapWidget` 대신 `PianoKeysWidget`을 렌더링하도록 분기 처리
  - **현악기(기타/베이스) 선택 시**:
    - `_FretboardPainter`에 `stringCount`와 `tuning` 정보 전달
    - `_FretboardPainter` 로직 수정: 하드코딩된 `6` 대신 `stringCount` 사용하여 줄 그리기 반복문 수정
    - 튜닝 텍스트 표시 로직을 `tuning` 리스트 기반으로 변경

## 5. 위젯 리팩토링: 코드 다이어그램 (Chord Diagram)
### 목표: 악기에 따른 코드 운지법 또는 건반 시각화
- [ ] `lib/widgets/common/chord_info_section.dart` 수정
  - 악기에 따라 `GuitarChordWidget`과 `PianoKeysWidget` 교체 렌더링
- [ ] `lib/widgets/common/guitar/guitar_chord_widget.dart` 수정
  - 클래스명을 `StringChordWidget` 등으로 변경 고려 (선택사항)
  - `SettingsState`의 악기 정보를 받아 `stringCount`에 맞춰 그리드 및 점(Note) 위치 계산 수정
  - 베이스의 경우 코드 보이싱 데이터가 다를 수 있으므로, 임시적으로 루트 및 코드톤 매핑 로직 점검 (추후 베이스 전용 보이싱 알고리즘 필요할 수 있음)

## 6. 테스트 및 검증
- [ ] 환경설정에서 '베이스' 선택 후 프렛보드가 4줄로 변하는지 확인
- [ ] 환경설정에서 '피아노' 선택 후 프렛보드 대신 피아노 건반이 표시되는지 확인
- [ ] 다크/라이트 모드에서 시인성 확인
